<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Track tyre blowouts per month for 2024 vs 2025, with insights straight from the register.">
    <title>Tyre Blowouts | KDG Logistics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="../styles/dashboard.css" rel="stylesheet">
</head>

<body>
    <header class="navbar sticky-top bg-dark flex-md-nowrap p-0 shadow" data-bs-theme="dark">
        <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6 text-white" href="home.html">KDG Logistics</a>
        <div class="d-flex align-items-center gap-2 me-3">
            <a class="btn btn-outline-light btn-sm" href="reports.html">Reports hub</a>
        </div>
    </header>

    <main class="page-shell">
        <section class="page-hero">
            <span class="badge">Tyre compliance</span>
            <h1>Monthly tyre blowouts 2025 vs 2024</h1>
            <p>Monitor monthly tyre blowouts and track improvements against last year's baseline.</p>
            <div class="hero-actions">
                <button class="btn btn-success" type="button" data-scroll-target="#chart-panel">View chart</button>
                <button class="btn btn-outline-light" type="button" data-scroll-target="#table-panel">Jump to
                    table</button>
            </div>
        </section>

        <section class="data-panel" aria-label="Contextual factors">
            <div class="panel-header">
                <div>
                    <p class="eyebrow">Why 2025 trended higher</p>
                    <h2>Contributing factors to blowout spikes</h2>
                </div>
            </div>
            <p class="mb-0">New tyre brands still in their bedding-in period, sustained exposure to poor road
                conditions, and the higher delivery mileage logged in 2025 vs 2024 have all contributed to the
                increased blowout counts.</p>
        </section>

        <section class="insights-grid" aria-label="Headline metrics">
            <article class="stat-card">
                <p class="stat-label">Total blowouts 2025</p>
                <p class="stat-value" id="stat-total-2025">--</p>
                <p class="stat-trend" id="stat-total-delta">--</p>
                <p class="stat-note">Δ vs 2024</p>
            </article>
            <article class="stat-card">
                <p class="stat-label">Zero-blowout months</p>
                <p class="stat-value" id="stat-zero">--</p>
                <p class="stat-note">Months with no recorded incidents in 2025</p>
            </article>
            <article class="stat-card">
                <p class="stat-label">Highest spike</p>
                <p class="stat-value" id="stat-worst">--</p>
                <p class="stat-note">Month with most issues in 2025 baseline</p>
            </article>
        </section>

        <section class="data-panel" id="chart-panel">
            <div class="panel-header">
                <div>
                    <p class="eyebrow">Visual comparison</p>
                    <h2>Blowouts per month</h2>
                    <p>Grouped bars show the year-on-year change. Hover for the exact count.</p>
                </div>
            </div>
            <div class="chart-wrapper" style="height:380px">
                <canvas id="blowoutChart" role="img" aria-label="Monthly blowout comparison chart"></canvas>
            </div>
        </section>

        <section class="data-panel" id="table-panel">
            <div class="panel-header">
                <div>
                    <p class="eyebrow">Supporting data</p>
                    <h2>Blowout register snapshot</h2>
                    <p>Search a month to highlight the variance.</p>
                </div>
                <div class="table-controls">
                    <input type="search" class="table-search" placeholder="Search month"
                        data-table-filter="blowout-table">
                </div>
            </div>
            <div class="doc-table-wrapper">
                <table class="doc-table" id="blowout-table">
                    <thead>
                        <tr>
                            <th scope="col">Month</th>
                            <th scope="col">2024 blowouts</th>
                            <th scope="col">2025 blowouts</th>
                            <th scope="col">Δ 2025-2024</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                    <tfoot>
                        <tr>
                            <th scope="row">Totals</th>
                            <td id="table-total-2024">--</td>
                            <td id="table-total-2025">--</td>
                            <td id="table-total-delta">--</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <p class="table-caption">Negative Δ values mean 2025 improved vs 2024.</p>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"
        integrity="sha384-gdQErvCNWvHQZj6XZM0dNsAoY4v+j5P1XDpNkcM3HJG1Yx04ecqIHk7+4VBOCHOG"
        crossorigin="anonymous"></script>
    <script>
        const blowoutData = {
            months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
            values2024: [2, 1, 4, 4, 0, 0, 3, 0, 1, 1, 3, 3],
            values2025: [0, 2, 4, 5, 1, 4, 3, 3, 0, 2, 0, 2,] // Placeholder – replace with 2025 figures
        };

        const formatter = new Intl.NumberFormat("en-ZA", { maximumFractionDigits: 0 });
        const percentFormatter = new Intl.NumberFormat("en-ZA", { maximumFractionDigits: 1 });

        function buildTrendMarkup(delta, baseline, improvementLabel = "Fewer blowouts", regressionLabel = "More blowouts") {
            const percentChange = baseline === 0 ? null : (Math.abs(delta) / baseline) * 100;
            let trendClass = "trend-flat";
            let arrow = "&rarr;";
            let descriptor = "No change";
            if (delta < 0) {
                trendClass = "trend-down";
                arrow = "&darr;";
                descriptor = improvementLabel;
            } else if (delta > 0) {
                trendClass = "trend-up";
                arrow = "&uarr;";
                descriptor = regressionLabel;
            }
            const percentLabel = percentChange === null ? "n/a" : `${percentFormatter.format(percentChange)}%`;
            const deltaLabel = delta === 0 ? "No change vs 2024" : `${delta >= 0 ? "+" : ""}${formatter.format(delta)} vs 2024`;
            return `
                <span class="trend-indicator ${trendClass}">${arrow} ${percentLabel} ${descriptor}</span>
                <span class="trend-delta">${deltaLabel}</span>
            `;
        }

        function buildChart() {
            const canvas = document.getElementById("blowoutChart");
            if (!canvas) return null;
            return new Chart(canvas, {
                type: "bar",
                data: {
                    labels: blowoutData.months,
                    datasets: [
                        {
                            label: "2025",
                            data: blowoutData.values2025,
                            backgroundColor: "rgba(247, 162, 82, 0.7)",
                            borderRadius: 6,
                        },
                        {
                            label: "2024",
                            data: blowoutData.values2024,
                            backgroundColor: "rgba(15, 179, 108, 0.75)",
                            borderRadius: 6,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: "index" },
                    plugins: {
                        legend: {
                            labels: { color: "#c8d5cf", font: { family: "Space Grotesk" } }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: "#9aa79f" },
                            grid: { color: "rgba(255,255,255,0.05)" }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { color: "#9aa79f", stepSize: 1 },
                            grid: { color: "rgba(255,255,255,0.08)" },
                            title: { display: true, text: "Blowouts", color: "#c8d5cf" }
                        }
                    }
                }
            });
        }

        function populateStats() {
            const total2024 = blowoutData.values2024.reduce((sum, value) => sum + value, 0);
            const total2025 = blowoutData.values2025.reduce((sum, value) => sum + value, 0);
            const delta = total2025 - total2024;
            document.getElementById("stat-total-2025").textContent = formatter.format(total2025);
            const trendMarkup = buildTrendMarkup(delta, total2024, "Improvement", "More blowouts");
            const trendTarget = document.getElementById("stat-total-delta");
            if (trendTarget) {
                trendTarget.innerHTML = trendMarkup;
            }
            const zeroMonths = blowoutData.months.filter((_, idx) => blowoutData.values2025[idx] === 0);
            document.getElementById("stat-zero").textContent = zeroMonths.length ? zeroMonths.join(", ") : "None";
            const maxValue = Math.max(...blowoutData.values2025);
            const worstIndex = blowoutData.values2025.findIndex((value) => value === maxValue);
            document.getElementById("stat-worst").textContent = `${blowoutData.months[worstIndex]} (${maxValue})`;

            const total2024Cell = document.getElementById("table-total-2024");
            const total2025Cell = document.getElementById("table-total-2025");
            const totalDeltaCell = document.getElementById("table-total-delta");
            if (total2024Cell) total2024Cell.textContent = formatter.format(total2024);
            if (total2025Cell) total2025Cell.textContent = formatter.format(total2025);
            if (totalDeltaCell) {
                totalDeltaCell.innerHTML = trendMarkup;
                totalDeltaCell.classList.remove("variance-positive", "variance-negative");
                if (delta > 0) {
                    totalDeltaCell.classList.add("variance-positive");
                } else if (delta < 0) {
                    totalDeltaCell.classList.add("variance-negative");
                }
            }
        }

        function buildTable() {
            const tbody = document.querySelector("#blowout-table tbody");
            if (!tbody) return;
            tbody.innerHTML = "";
            blowoutData.months.forEach((month, index) => {
                const base = blowoutData.values2024[index];
                const current = blowoutData.values2025[index];
                const delta = current - base;
                const trendMarkup = buildTrendMarkup(delta, base);
                const deltaClass = delta > 0 ? "variance-positive" : delta < 0 ? "variance-negative" : "";
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${month}</td>
                    <td>${formatter.format(base)}</td>
                    <td>${formatter.format(current)}</td>
                    <td class="${deltaClass}">
                        ${trendMarkup}
                    </td>`;
                tbody.appendChild(row);
            });
        }

        function wireScrollLinks() {
            document.querySelectorAll("[data-scroll-target]").forEach((trigger) => {
                trigger.addEventListener("click", (event) => {
                    event.preventDefault();
                    const selector = trigger.getAttribute("data-scroll-target");
                    const target = selector ? document.querySelector(selector) : null;
                    if (target) {
                        target.scrollIntoView({ behavior: "smooth", block: "start" });
                    }
                });
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            buildChart();
            populateStats();
            buildTable();
            wireScrollLinks();
        });
    </script>
    <script src="../scripts/core/pages.js"></script>
</body>

</html>