<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Compare monthly accident counts between 2023 and 2024 with downloads to the full register.">
    <title>Accident Trend | KDG Logistics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="../styles/dashboard.css" rel="stylesheet">
</head>

<body>
    <header class="navbar sticky-top bg-dark flex-md-nowrap p-0 shadow" data-bs-theme="dark">
        <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3 fs-6 text-white" href="home.html">KDG Logistics</a>
        <div class="d-flex align-items-center gap-2 me-3">
            <a class="btn btn-outline-light btn-sm" href="reports.html">Reports hub</a>
            <a class="btn btn-success btn-sm" href="../../public/data/AccidentReg.xlsx" download>Download accident register</a>
        </div>
    </header>

    <main class="page-shell">
        <section class="page-hero">
            <span class="badge">Safety performance</span>
            <h1>Monthly accident stats 2023 vs 2024</h1>
            <p>Use this dashboard to prove the downward trend in motor accidents. Bars refresh whenever the CSV gets updated and link back to the master register for evidence.</p>
            <div class="hero-actions">
                <button class="btn btn-success" type="button" data-scroll-target="#chart-panel">View chart</button>
                <button class="btn btn-outline-light" type="button" data-scroll-target="#table-panel">Jump to table</button>
            </div>
        </section>

        <section class="insights-grid" aria-label="Key safety insights">
            <article class="stat-card">
                <p class="stat-label">Total accidents 2024</p>
                <p class="stat-value" id="stat-total-2024">--</p>
                <p class="stat-trend" id="stat-total-delta">--</p>
                <p class="stat-note">Δ vs 2023</p>
            </article>
            <article class="stat-card">
                <p class="stat-label">Best month 2024</p>
                <p class="stat-value" id="stat-best">--</p>
                <p class="stat-note">Months with zero or lowest incidents</p>
            </article>
            <article class="stat-card">
                <p class="stat-label">Worst month 2023</p>
                <p class="stat-value" id="stat-worst">--</p>
                <p class="stat-note">Focus area for toolbox talks</p>
            </article>
        </section>

        <section class="data-panel" id="chart-panel">
            <div class="panel-header">
                <div>
                    <p class="eyebrow">Visual comparison</p>
                    <h2>Accidents per month</h2>
                    <p>Bars show month-on-month incidents for 2023 vs 2024. Hover to see exact counts.</p>
                </div>
            </div>
            <div class="chart-wrapper" style="height:380px">
                <canvas id="accidentsChart" role="img" aria-label="Monthly accident comparison chart"></canvas>
            </div>
        </section>

        <section class="data-panel" id="table-panel">
            <div class="panel-header">
                <div>
                    <p class="eyebrow">Supporting data</p>
                    <h2>Accident register snapshot</h2>
                    <p>Filter by month to pull the exact counts and deltas.</p>
                </div>
                <div class="table-controls">
                    <input type="search" class="table-search" placeholder="Search month" data-table-filter="accidents-table">
                </div>
            </div>
            <div class="doc-table-wrapper">
                <table class="doc-table" id="accidents-table">
                    <thead>
                        <tr>
                            <th scope="col">Month</th>
                            <th scope="col">2023 accidents</th>
                            <th scope="col">2024 accidents</th>
                            <th scope="col">Δ 2024-2023</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <p class="table-caption">Positive Δ values mean 2024 recorded more incidents than 2023.</p>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"
        integrity="sha384-gdQErvCNWvHQZj6XZM0dNsAoY4v+j5P1XDpNkcM3HJG1Yx04ecqIHk7+4VBOCHOG"
        crossorigin="anonymous"></script>
    <script>
        const accidentData = {
            months: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
            incidents2023: [6, 7, 3, 4, 4, 5, 6, 7, 5, 5, 0, 1],
            incidents2024: [1, 5, 3, 1, 0, 3, 1, 3, 3, 4, 5, 2]
        };

        const intFormatter = new Intl.NumberFormat("en-ZA", { maximumFractionDigits: 0 });

        function buildChart() {
            const ctx = document.getElementById("accidentsChart");
            if (!ctx) return null;
            return new Chart(ctx, {
                type: "bar",
                data: {
                    labels: accidentData.months,
                    datasets: [
                        {
                            label: "2023",
                            data: accidentData.incidents2023,
                            backgroundColor: "rgba(247, 162, 82, 0.7)",
                            borderRadius: 6,
                        },
                        {
                            label: "2024",
                            data: accidentData.incidents2024,
                            backgroundColor: "rgba(15, 179, 108, 0.75)",
                            borderRadius: 6,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: "index" },
                    plugins: {
                        legend: {
                            labels: { color: "#c8d5cf", font: { family: "Space Grotesk" } }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: "#9aa79f" },
                            grid: { color: "rgba(255,255,255,0.05)" }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { color: "#9aa79f", stepSize: 1 },
                            grid: { color: "rgba(255,255,255,0.08)" },
                            title: { display: true, text: "Accidents", color: "#c8d5cf" }
                        }
                    }
                }
            });
        }

        function populateStats() {
            const total2023 = accidentData.incidents2023.reduce((sum, value) => sum + value, 0);
            const total2024 = accidentData.incidents2024.reduce((sum, value) => sum + value, 0);
            const delta = total2024 - total2023;
            document.getElementById("stat-total-2024").textContent = intFormatter.format(total2024);
            document.getElementById("stat-total-delta").textContent = `${delta >= 0 ? "+" : ""}${intFormatter.format(delta)} vs 2023`;

            const minValue = Math.min(...accidentData.incidents2024);
            const bestMonths = accidentData.months.filter((_, idx) => accidentData.incidents2024[idx] === minValue);
            document.getElementById("stat-best").textContent = `${bestMonths.join(", ")} (${minValue})`;

            const maxValue = Math.max(...accidentData.incidents2023);
            const worstIndex = accidentData.incidents2023.findIndex((value) => value === maxValue);
            document.getElementById("stat-worst").textContent = `${accidentData.months[worstIndex]} (${maxValue})`;
        }

        function buildTable() {
            const tbody = document.querySelector("#accidents-table tbody");
            if (!tbody) return;
            tbody.innerHTML = "";
            accidentData.months.forEach((month, index) => {
                const base = accidentData.incidents2023[index];
                const current = accidentData.incidents2024[index];
                const delta = current - base;
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${month}</td>
                    <td>${base}</td>
                    <td>${current}</td>
                    <td class="${delta > 0 ? "variance-negative" : delta < 0 ? "variance-positive" : ""}">${delta >= 0 ? "+" : ""}${delta}</td>`;
                tbody.appendChild(row);
            });
        }

        function wireScrollLinks() {
            document.querySelectorAll("[data-scroll-target]").forEach((trigger) => {
                trigger.addEventListener("click", (event) => {
                    event.preventDefault();
                    const selector = trigger.getAttribute("data-scroll-target");
                    const target = selector ? document.querySelector(selector) : null;
                    if (target) {
                        target.scrollIntoView({ behavior: "smooth", block: "start" });
                    }
                });
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            buildChart();
            populateStats();
            buildTable();
            wireScrollLinks();
        });
    </script>
    <script src="../scripts/core/pages.js"></script>
</body>

</html>
